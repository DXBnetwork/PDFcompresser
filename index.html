<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PDF Splitter by Size</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 0 20px; }
    h1 { text-align: center; }
    input, button { display: block; width: 100%; margin: 10px 0; padding: 10px; font-size: 1rem; }
    #downloads a { margin: 5px 0; display: inline-block; }
  </style>
</head>
<body>
  <h1>PDF Splitter by Size</h1>
  <input type="file" id="pdfFile" accept="application/pdf">
  <label for="maxSize">Max size (MB):</label>
  <input type="number" id="maxSize" value="10" min="1" step="1">
  <button id="splitBtn">Split PDF</button>
  <div id="downloads"></div>

  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script>
  document.getElementById('splitBtn').addEventListener('click', async () => {
    const fileInput = document.getElementById('pdfFile');
    if (!fileInput.files.length) { alert('Please select a PDF file.'); return; }
    const file = fileInput.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const srcPdf = await PDFLib.PDFDocument.load(arrayBuffer);
    const totalPages = srcPdf.getPageCount();
    const maxBytes = parseInt(document.getElementById('maxSize').value) * 1024 * 1024;
    let pages = [];
    let part = 1;
    const downloadsDiv = document.getElementById('downloads');
    downloadsDiv.innerHTML = '';

    for (let i = 0; i < totalPages; i++) {
      const testPages = pages.concat(i);
      const testDoc = await PDFLib.PDFDocument.create();
      const copied = await testDoc.copyPages(srcPdf, testPages);
      copied.forEach(p => testDoc.addPage(p));
      const bytes = await testDoc.save();

      if (bytes.byteLength <= maxBytes) {
        pages = testPages;
      } else {
        if (pages.length === 0) {
          pages = testPages; // single page larger than max size
        }
        // finalize current part
        const finalDoc = await PDFLib.PDFDocument.create();
        const copiedPages = await finalDoc.copyPages(srcPdf, pages);
        copiedPages.forEach(p => finalDoc.addPage(p));
        const finalBytes = await finalDoc.save();
        const blob = new Blob([finalBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `part_${part}.pdf`;
        link.textContent = `Download part ${part}`;
        downloadsDiv.appendChild(link);
        downloadsDiv.appendChild(document.createElement('br'));

        part++;
        pages = [i];
      }
    }

    // finalize remaining pages
    if (pages.length) {
      const finalDoc = await PDFLib.PDFDocument.create();
      const copiedPages = await finalDoc.copyPages(srcPdf, pages);
      copiedPages.forEach(p => finalDoc.addPage(p));
      const finalBytes = await finalDoc.save();
      const blob = new Blob([finalBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `part_${part}.pdf`;
      link.textContent = `Download part ${part}`;
      downloadsDiv.appendChild(link);
    }
  });
  </script>
</body>
</html>
